---
title: "README"
author: "Andrew MacDonald"
date: "May 25, 2015"
output: md_document
---

[![Travis-CI Build Status](https://travis-ci.org/SrivastavaLab/bwgtools.png?branch=master)](https://travis-ci.org/SrivastavaLab/bwgtools)

# Introduction
This is an R package for the bromeliad working group rainfall experiment. Our intention is to create a set of tools that facilitate all steps of the process:

* loading data into R
* combining data from different replicates
* performing calculations

At present the package allows each group of authors to obtain the datasets they will need to **begin** their analysis.

Please [open an issue](https://github.com/SrivastavaLab/bwgtools/issues) if there is a feature you would like to see, or if you discover an error or bug!

# Installation

`bwgtools` can be installed directly from Github using devtools:

```r
install.packages("devtools") # if you don't have devtools
library(devtools)
install_github("SrivastavaLab/bwgtools", dependencies = TRUE)
```

# Accessing Dropbox

`bwgtools` uses [rdrop2](https://github.com/karthik/rdrop2) to access your Dropbox account, then uses [readxl](https://github.com/hadley/readxl) to download the data and read it directly into R. When you first run `library(bwgtools)` you will see the following message:

```
Welcome to the bwg R package! in order to obtain data from the BWG dropbox folder, you need to authorize R to access your dropbox. run the following commands:
  library(rdrop2)
  drop_auth(cache = FALSE)
Then enter your username and password. This should only need to be done when downloading the data.
```

## Important Note: Protect your account!

**In Dropbox:** by default, `drop_auth()` saves your Dropbox login to a file called `.httr-oauth`. Of course, we don't want this shared with everyone in our Dropbox folder, as they would then be able to access your personal Dropbox account! Therefore, we set `cache=FALSE`. This will require us to re-authenticate every time we want to download fresh data. This should be a quick and painless process, especially if you are already logged in on your computer. However, bwgtools should work from any computer connected to the internet, provided that you have your Dropbox username and password.

**Working outside of Dropbox:** running `drop_acc()` or `drop_auth()` will create a file called `.httr-oauth` in your directory, which will contain your login credentials for Dropbox. **Remember to add this file to your .gitignore if you are using git**. For more information, see `?rdrop2::drop_auth`. 

# Reading a single sheet

Once you have authenticated with Dropbox, you can read data directly into R. To obtain a single tab (for example, the "leaf.waterdepths" tab) for a single site (for example, Macae), use the function `read_sheet_site`:

```{r}
macae <- read_site_sheet("Macae", "leaf.waterdepths")

knitr::kable(macae)
```

## Working offline
The first argument to this function can either be the name of a site (`"Macae"`, in the example above), **or** a path to the location of the file on your hard drive. In this README we are going to use the latter approach. This has two advantages: slightly faster (nothing needs to download) and it will work non-interactively (for example when using knitr).

the major _disadvantage_ is that your local version of the data may be behind the official version on the Dropbox website. To be safe, use the online version whenever you can.

```{r results='asis'}
library(bwgtools)
macae <- read_site_sheet("Macae", "leaf.waterdepths")
knitr::kable(head(macae))
```

This approach works for loading a single tab; we can also load and combine the same tab across all sites, with a single function:

```{r, warning=FALSE, message=FALSE, results='asis'}
library(dplyr)
library(knitr)
c("Argentina", "French_Guiana", "Colombia",
  "Macae", "PuertoRico","CostaRica") %>%
  combine_tab("site.info") %>% 
  head %>% 
  kable
```

# Validating the data
We can also do some basic checking 

```r
check_names(macae)
```

## Future plans

We want to use this package to store functions which reproduce all of the analyses of the Bromeliad Working Group.

### Licence
We release the code in this repository under the MIT software license. see text of license [here](LICENSE)
